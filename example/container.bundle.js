(()=>{"use strict";class e{constructor(){this.listeners={}}addEventListener(e,t){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push(t)}removeEventListener(e,t){const n=this.listeners[e]||[],r=n.indexOf(t);-1!==r&&n.splice(r,1)}emit(e,t){(this.listeners[e]||[]).forEach((e=>{e.call(this,t)}))}}function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function n(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?t(Object(o),!0).forEach((function(t){r(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class o extends e{constructor(e,t){super(),Object.assign(this,{dispatcher:e,opts:t,CHANGE:"change",state:n({},this.state||{})}),e.register((e=>{this._changed=!1,this._invoke(e)}))}getState(){return this.state}addListener(e){return this.addEventListener(this.CHANGE,e),{remove:()=>this.removeEventListener(this.CHANGE,e)}}getDispatcher(){return this.dispatcher}hasChanged(){return this._changed}_invoke(e){this.__onDispatch(e),this._changed&&this.emit(this.CHANGE)}__emitChange(){this._changed=!0}}class i extends o{constructor(e,t){super(e,t),this.state=n({},this.state||{})}areEqual(e,t){return e===t}_invoke(e){const t=this.reduce(this.state,e);if(!t)throw new Error("reduce() must not return undefined");this.areEqual(this.state,t)||(this.state=t,this.__emitChange(),this.emit(this.CHANGE))}}var l,_,s,u,c,a={},p=[],f=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function h(e,t){for(var n in t)e[n]=t[n];return e}function d(e){var t=e.parentNode;t&&t.removeChild(e)}function v(e,t,n){var r,o,i,_={};for(i in t)"key"==i?r=t[i]:"ref"==i?o=t[i]:_[i]=t[i];if(arguments.length>2&&(_.children=arguments.length>3?l.call(arguments,2):n),"function"==typeof e&&null!=e.defaultProps)for(i in e.defaultProps)void 0===_[i]&&(_[i]=e.defaultProps[i]);return y(e,_,r,o,null)}function y(e,t,n,r,o){var i={type:e,props:t,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:null==o?++s:o};return null==o&&null!=_.vnode&&_.vnode(i),i}function m(e){return e.children}function b(e,t){this.props=e,this.context=t}function g(e,t){if(null==t)return e.__?g(e.__,e.__.__k.indexOf(e)+1):null;for(var n;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e)return n.__e;return"function"==typeof e.type?g(e):null}function k(e){var t,n;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e){e.__e=e.__c.base=n.__e;break}return k(e)}}function w(e){(!e.__d&&(e.__d=!0)&&u.push(e)&&!S.__r++||c!==_.debounceRendering)&&((c=_.debounceRendering)||setTimeout)(S)}function S(){for(var e;S.__r=u.length;)e=u.sort((function(e,t){return e.__v.__b-t.__v.__b})),u=[],e.some((function(e){var t,n,r,o,i,l;e.__d&&(i=(o=(t=e).__v).__e,(l=t.__P)&&(n=[],(r=h({},o)).__v=o.__v+1,L(l,o,r,t.__n,void 0!==l.ownerSVGElement,null!=o.__h?[i]:null,n,null==i?g(o):i,o.__h),A(n,o),o.__e!=i&&k(o)))}))}function O(e,t,n,r,o,i,l,_,s,u){var c,f,h,d,v,b,k,w=r&&r.__k||p,S=w.length;for(n.__k=[],c=0;c<t.length;c++)if(null!=(d=n.__k[c]=null==(d=t[c])||"boolean"==typeof d?null:"string"==typeof d||"number"==typeof d||"bigint"==typeof d?y(null,d,null,null,d):Array.isArray(d)?y(m,{children:d},null,null,null):d.__b>0?y(d.type,d.props,d.key,d.ref?d.ref:null,d.__v):d)){if(d.__=n,d.__b=n.__b+1,null===(h=w[c])||h&&d.key==h.key&&d.type===h.type)w[c]=void 0;else for(f=0;f<S;f++){if((h=w[f])&&d.key==h.key&&d.type===h.type){w[f]=void 0;break}h=null}L(e,d,h=h||a,o,i,l,_,s,u),v=d.__e,(f=d.ref)&&h.ref!=f&&(k||(k=[]),h.ref&&k.push(h.ref,null,d),k.push(f,d.__c||v,d)),null!=v?(null==b&&(b=v),"function"==typeof d.type&&d.__k===h.__k?d.__d=s=E(d,s,e):s=P(e,d,h,w,v,s),"function"==typeof n.type&&(n.__d=s)):s&&h.__e==s&&s.parentNode!=e&&(s=g(h))}for(n.__e=b,c=S;c--;)null!=w[c]&&("function"==typeof n.type&&null!=w[c].__e&&w[c].__e==n.__d&&(n.__d=g(r,c+1)),U(w[c],w[c]));if(k)for(c=0;c<k.length;c++)T(k[c],k[++c],k[++c])}function E(e,t,n){for(var r,o=e.__k,i=0;o&&i<o.length;i++)(r=o[i])&&(r.__=e,t="function"==typeof r.type?E(r,t,n):P(n,r,r,o,r.__e,t));return t}function P(e,t,n,r,o,i){var l,_,s;if(void 0!==t.__d)l=t.__d,t.__d=void 0;else if(null==n||o!=i||null==o.parentNode)e:if(null==i||i.parentNode!==e)e.appendChild(o),l=null;else{for(_=i,s=0;(_=_.nextSibling)&&s<r.length;s+=2)if(_==o)break e;e.insertBefore(o,i),l=i}return void 0!==l?l:o.nextSibling}function D(e,t,n){"-"===t[0]?e.setProperty(t,n):e[t]=null==n?"":"number"!=typeof n||f.test(t)?n:n+"px"}function x(e,t,n,r,o){var i;e:if("style"===t)if("string"==typeof n)e.style.cssText=n;else{if("string"==typeof r&&(e.style.cssText=r=""),r)for(t in r)n&&t in n||D(e.style,t,"");if(n)for(t in n)r&&n[t]===r[t]||D(e.style,t,n[t])}else if("o"===t[0]&&"n"===t[1])i=t!==(t=t.replace(/Capture$/,"")),t=t.toLowerCase()in e?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+i]=n,n?r||e.addEventListener(t,i?C:j,i):e.removeEventListener(t,i?C:j,i);else if("dangerouslySetInnerHTML"!==t){if(o)t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("href"!==t&&"list"!==t&&"form"!==t&&"tabIndex"!==t&&"download"!==t&&t in e)try{e[t]=null==n?"":n;break e}catch(e){}"function"==typeof n||(null!=n&&(!1!==n||"a"===t[0]&&"r"===t[1])?e.setAttribute(t,n):e.removeAttribute(t))}}function j(e){this.l[e.type+!1](_.event?_.event(e):e)}function C(e){this.l[e.type+!0](_.event?_.event(e):e)}function L(e,t,n,r,o,i,l,s,u){var c,a,p,f,d,v,y,g,k,w,S,E,P,D=t.type;if(void 0!==t.constructor)return null;null!=n.__h&&(u=n.__h,s=t.__e=n.__e,t.__h=null,i=[s]),(c=_.__b)&&c(t);try{e:if("function"==typeof D){if(g=t.props,k=(c=D.contextType)&&r[c.__c],w=c?k?k.props.value:c.__:r,n.__c?y=(a=t.__c=n.__c).__=a.__E:("prototype"in D&&D.prototype.render?t.__c=a=new D(g,w):(t.__c=a=new b(g,w),a.constructor=D,a.render=M),k&&k.sub(a),a.props=g,a.state||(a.state={}),a.context=w,a.__n=r,p=a.__d=!0,a.__h=[]),null==a.__s&&(a.__s=a.state),null!=D.getDerivedStateFromProps&&(a.__s==a.state&&(a.__s=h({},a.__s)),h(a.__s,D.getDerivedStateFromProps(g,a.__s))),f=a.props,d=a.state,p)null==D.getDerivedStateFromProps&&null!=a.componentWillMount&&a.componentWillMount(),null!=a.componentDidMount&&a.__h.push(a.componentDidMount);else{if(null==D.getDerivedStateFromProps&&g!==f&&null!=a.componentWillReceiveProps&&a.componentWillReceiveProps(g,w),!a.__e&&null!=a.shouldComponentUpdate&&!1===a.shouldComponentUpdate(g,a.__s,w)||t.__v===n.__v){a.props=g,a.state=a.__s,t.__v!==n.__v&&(a.__d=!1),a.__v=t,t.__e=n.__e,t.__k=n.__k,t.__k.forEach((function(e){e&&(e.__=t)})),a.__h.length&&l.push(a);break e}null!=a.componentWillUpdate&&a.componentWillUpdate(g,a.__s,w),null!=a.componentDidUpdate&&a.__h.push((function(){a.componentDidUpdate(f,d,v)}))}if(a.context=w,a.props=g,a.__v=t,a.__P=e,S=_.__r,E=0,"prototype"in D&&D.prototype.render)a.state=a.__s,a.__d=!1,S&&S(t),c=a.render(a.props,a.state,a.context);else do{a.__d=!1,S&&S(t),c=a.render(a.props,a.state,a.context),a.state=a.__s}while(a.__d&&++E<25);a.state=a.__s,null!=a.getChildContext&&(r=h(h({},r),a.getChildContext())),p||null==a.getSnapshotBeforeUpdate||(v=a.getSnapshotBeforeUpdate(f,d)),P=null!=c&&c.type===m&&null==c.key?c.props.children:c,O(e,Array.isArray(P)?P:[P],t,n,r,o,i,l,s,u),a.base=t.__e,t.__h=null,a.__h.length&&l.push(a),y&&(a.__E=a.__=null),a.__e=!1}else null==i&&t.__v===n.__v?(t.__k=n.__k,t.__e=n.__e):t.__e=N(n.__e,t,n,r,o,i,l,u);(c=_.diffed)&&c(t)}catch(e){t.__v=null,(u||null!=i)&&(t.__e=s,t.__h=!!u,i[i.indexOf(s)]=null),_.__e(e,t,n)}}function A(e,t){_.__c&&_.__c(t,e),e.some((function(t){try{e=t.__h,t.__h=[],e.some((function(e){e.call(t)}))}catch(e){_.__e(e,t.__v)}}))}function N(e,t,n,r,o,i,_,s){var u,c,p,f=n.props,h=t.props,v=t.type,y=0;if("svg"===v&&(o=!0),null!=i)for(;y<i.length;y++)if((u=i[y])&&"setAttribute"in u==!!v&&(v?u.localName===v:3===u.nodeType)){e=u,i[y]=null;break}if(null==e){if(null===v)return document.createTextNode(h);e=o?document.createElementNS("http://www.w3.org/2000/svg",v):document.createElement(v,h.is&&h),i=null,s=!1}if(null===v)f===h||s&&e.data===h||(e.data=h);else{if(i=i&&l.call(e.childNodes),c=(f=n.props||a).dangerouslySetInnerHTML,p=h.dangerouslySetInnerHTML,!s){if(null!=i)for(f={},y=0;y<e.attributes.length;y++)f[e.attributes[y].name]=e.attributes[y].value;(p||c)&&(p&&(c&&p.__html==c.__html||p.__html===e.innerHTML)||(e.innerHTML=p&&p.__html||""))}if(function(e,t,n,r,o){var i;for(i in n)"children"===i||"key"===i||i in t||x(e,i,null,n[i],r);for(i in t)o&&"function"!=typeof t[i]||"children"===i||"key"===i||"value"===i||"checked"===i||n[i]===t[i]||x(e,i,t[i],n[i],r)}(e,h,f,o,s),p)t.__k=[];else if(y=t.props.children,O(e,Array.isArray(y)?y:[y],t,n,r,o&&"foreignObject"!==v,i,_,i?i[0]:n.__k&&g(n,0),s),null!=i)for(y=i.length;y--;)null!=i[y]&&d(i[y]);s||("value"in h&&void 0!==(y=h.value)&&(y!==e.value||"progress"===v&&!y||"option"===v&&y!==f.value)&&x(e,"value",y,f.value,!1),"checked"in h&&void 0!==(y=h.checked)&&y!==e.checked&&x(e,"checked",y,f.checked,!1))}return e}function T(e,t,n){try{"function"==typeof e?e(t):e.current=t}catch(e){_.__e(e,n)}}function U(e,t,n){var r,o;if(_.unmount&&_.unmount(e),(r=e.ref)&&(r.current&&r.current!==e.__e||T(r,null,t)),null!=(r=e.__c)){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(e){_.__e(e,t)}r.base=r.__P=null,e.__c=void 0}if(r=e.__k)for(o=0;o<r.length;o++)r[o]&&U(r[o],t,"function"!=typeof e.type);n||null==e.__e||d(e.__e),e.__=e.__e=e.__d=void 0}function M(e,t,n){return this.constructor(e,n)}function H(e){return H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},H(e)}function W(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function R(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function F(e,t,n){return t&&R(e.prototype,t),n&&R(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function G(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&B(e,t)}function B(e,t){return B=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},B(e,t)}function I(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=V(e);if(t){var o=V(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return $(this,n)}}function $(e,t){if(t&&("object"===H(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return q(e)}function q(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function V(e){return V=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},V(e)}function z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}l=p.slice,_={__e:function(e,t,n,r){for(var o,i,l;t=t.__;)if((o=t.__c)&&!o.__)try{if((i=o.constructor)&&null!=i.getDerivedStateFromError&&(o.setState(i.getDerivedStateFromError(e)),l=o.__d),null!=o.componentDidCatch&&(o.componentDidCatch(e,r||{}),l=o.__d),l)return o.__E=o}catch(t){e=t}throw e}},s=0,b.prototype.setState=function(e,t){var n;n=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=h({},this.state),"function"==typeof e&&(e=e(h({},n),this.props)),e&&h(n,e),null!=e&&this.__v&&(t&&this.__h.push(t),w(this))},b.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),w(this))},b.prototype.render=m,u=[],S.__r=0;var J=function(e){return(e+1)%3},K=function(e){G(n,e);var t=I(n);function n(){var e;W(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return z(q(e=t.call.apply(t,[this].concat(o))),"state",{value:"...",step:0}),e}return F(n,[{key:"reduce",value:function(e){var t=e.step;return{step:t=J(t),value:t?"hello":"..."}}}]),n}(i),Q=function(e){G(n,e);var t=I(n);function n(){var e;W(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return z(q(e=t.call.apply(t,[this].concat(o))),"state",{value:"",step:0}),e}return F(n,[{key:"reduce",value:function(e){var t=e.step;return{step:t=J(t),value:2===t?"world":""}}}]),n}(i),X=new class extends e{constructor(){super(),this.token=`dispatch${Math.random()}`,Object.assign(this,{_isDispatching:!1,dispatch:this.dispatch.bind(this),register:this.addEventListener.bind(this,this.token),unregister:this.removeEventListener.bind(this,this.token)})}isDispatching(){return this._isDispatching}dispatch(e){if(this._isDispatching)throw new Error("can't dispatch in the middle of a dispatch");this._isDispatching=!0,this.emit(this.token,e),this._isDispatching=!1}},Y=[new K(X),new Q(X)],Z=function(e,t=e.getStores,r=e.calculateState){return class extends e{constructor(e,o){super(e,o),Object.assign(this,{state:n(n({},this.state||{}),r(this.state,e,o)),stores:t(this.props,this.context),_onState:this._onState.bind(this)})}componentDidMount(){super.componentDidMount&&super.componentDidMount(),this._addStores()}componentWillUnmount(){super.componentWillUnmount&&super.componentWillUnmount(),this._removeStores()}static getDerivedStateFromProps(t,n){return"function"==typeof e.getDerivedStateFromProps?e.getDerivedStateFromProps(t,n):null}_onState(){this.setState(((e,t)=>r(e,t,this.context)))}_addStores(){this._removers=this.stores.map((e=>e.addListener(this._onState)))}_removeStores(){this._removers&&this._removers.forEach((e=>e.remove()))}}}(function(e){G(n,e);var t=I(n);function n(){return W(this,n),t.apply(this,arguments)}return F(n,[{key:"render",value:function(){var e=this.state,t=e.step,n=e.value;return v("span",null,v("h1",null,"femto-flux connect example"),v("div",null,n),v("button",{onClick:function(){return X.dispatch()}},"click #",t))}}],[{key:"getStores",value:function(){return Y}},{key:"calculateState",value:function(){var e=Y[0].getState().step;return{value:Y.map((function(e){return e.getState().value})).join(" ").trim(),step:e}}}]),n}(b)),ee=document.createElement("div");document.body.insertBefore(ee,document.body.firstChild),function(e,t,n){var r,o,i;_.__&&_.__(e,t),o=(r="function"==typeof n)?null:n&&n.__k||t.__k,i=[],L(t,e=(!r&&n||t).__k=v(m,null,[e]),o||a,a,void 0!==t.ownerSVGElement,!r&&n?[n]:o?null:t.firstChild?l.call(t.childNodes):null,i,!r&&n?n:o?o.__e:t.firstChild,r),A(i,e)}(v(Z,null),ee)})();